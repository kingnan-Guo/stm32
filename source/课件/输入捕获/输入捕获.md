1、每次电平跳变后会 将cnt 的值 记录到 ccr 中，然后 cnt 清零； 可使用 主从触发模式来完成
# 频率测量
![频率测量.png](%E9%A2%91%E7%8E%87%E6%B5%8B%E9%87%8F.png)

![输入捕获比较通道.png](%E8%BE%93%E5%85%A5%E6%8D%95%E8%8E%B7%E6%AF%94%E8%BE%83%E9%80%9A%E9%81%93.png)

DTS 滤波器的采样时钟 
ICF 可以控制滤波的参数 通过 采样频率 检测
## 过程
1、TI1 输入 进入滤波器
2、滤波后 通过 边沿检测器 捕获上升沿 或者 下降沿
3、CCR寄存器的CC1P 位 可以选择极性；[是否取反]
4、最终得到TI1FP1 触发信号
5、通过数据选择器 进入 通道1 后续的 捕获电路 
    a、这里下面还有 一套TI1FP2的电路 ；联通通道2 的后续
7、CC1S位可以对数据选择器进行选择 
8、icps 位可以配置分频器 选择 不分频 2分频 4分频 8分频
9、CC1E 控制输出使能 还是失能
    a、如果使能 输出 输入端产生指定的边沿信号 ，经过层层电路后，可以让这里的CNT值 转运到CCR中；每捕获一次CNT的值 都到把 cnt清零一下
    b、这里硬件可以自定完成清零，原理是， TF1P1 和 TI1的边沿信号(TI1_ED) 都可以通过 从模式控制器； 从模式有电路可以自动完成 cnt 清零

## 主从触发模式
![主从触发模式.png](%E4%B8%BB%E4%BB%8E%E8%A7%A6%E5%8F%91%E6%A8%A1%E5%BC%8F.png)

1、主模式可以将定时器内部的信号映射到 TRGO；用于触发别的 外设 （所以叫主模式）
2、从模式 就是 接收其他外设  或者自身外设的 一些信号信息； 用于控制自身定时器 的 运行，也就是被别的信号控制
3、触发源 选择 就是选择 从模式触发源的 触发信号源（从模式的一部分）；触发源选择 指定的 一个信号 TRGI; TRGI 去触发模式（从模式）选择 操作来自动执行

eg：想让 TI1FP1 信号 自动触发 CNT 清零
    触发源选择： TI1FP1 
    从模式： 执行   Reset 操作 

# 触发器选择
![触发选择.png](%E8%A7%A6%E5%8F%91%E9%80%89%E6%8B%A9.png)   

# 从模式选择
![从模式选择.png](%E4%BB%8E%E6%A8%A1%E5%BC%8F%E9%80%89%E6%8B%A9.png)

# 输入捕获基本结构
![输入捕获基本结构.png](%E8%BE%93%E5%85%A5%E6%8D%95%E8%8E%B7%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84.png)
1、只是用了一个通道 所以只能测量频率
2、右上角 的时机单元 ； 把时机单元配置好 ， 启动定时器；那么这个CNT 就会在预分频之后的这个 时钟驱动下，不断自增；这个CNT 就是测周法 用来计数的； 经过预分频之后的 的时钟频率，就是驱动CNT的标准频率 Fc
3、这里 的标准 频率 = 72MHZ/预分频系数
4、然后输入捕获 通道1  的 GPIO， 输入一个 方波信号，经过滤波器的边沿检测；选择TI1FP1为上升沿触发  ；输出TI1FP1
5、之后选择直连 通道，分频器选择 不分频；
6、TI1FP1 出现上升沿之后 CNT 的当前记录纸 转到 CCR1 中；
7、同时 触发源选择，选中TI1FP1 为触发信号； 从模式选择 复位 操作
8、TF1FP1 的上升沿 也会通过 触发源选择 再到 从模式 去触发 CNT 清零
9、 先后顺序 是 先 CNT 传值  CCR1 ，然后在去清除CNT
10、 cnt 在 一个周期之内 不断自增  ，知道下一个上升沿来临 ；然后清零； CCR1 里永远保持最新的计数值

** CNT 最大 65535；如果信号频率太多 CNT 可能 会溢出
**  如果想使用从模式 自动清零 那么只有 通道1  通道2；TF1FP1 TF2FP2；  通道3 通道4 只能开启 捕获中断，在中断中手动 清零




# PWMI基本结构
![PWMI基本结构.png](PWMI%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84.png)


1、使用两个通道 同时 捕获一个引脚，可以同时测量周期和占空比
2、TI1FP2 配置下降沿触发； 通过交叉通道 ，去触发 通道2 的 CCR2 捕获单元
3、所以 CCR2的值 就是 上升沿 到下降沿的值； 就是高电平期间的 值
4、CCR2 捕获 并不会触发 CNT 清零，知道 下一个 上升沿周期 CNT 清零
5、CCR1 就是一整个期间的计数值
6、 占空比 就是 CCR2/CCR1s
